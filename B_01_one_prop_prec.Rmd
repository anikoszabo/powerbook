# One-sample proportion: precision-based sample size

## Example

An educator wants to conduct a survey of first-year medical residents. The survey contains yes/no questions for several specific medical procedures asking whether they would be comfortable performing it without the presence of an attending physician. How many residents should he recruit?

## Data generating mechanism

Independent identically distributed variables $X_1, \ldots, X_n \sim Bernoulli(p)$ with $p$, the event probability as the parameter of interest.

It will be estimated as the sample proportion $\hat{p} = \sum_{i=1}^n X_i / n$. Inference can be based on the exact distribution of $X = \sum_{i=1}^n X_i \sim Binom(n,p)$ or the asymptotic distribution of $\hat{p} \sim N(p, \frac{p(1-p)}{n})$.

## Precision measures

### Standard error

The standard error of $\hat{p}$ is

\begin{equation}
SE(\hat{p}) = \sqrt\frac{p(1-p)}{n} 
\end{equation}


```{r OnePropSE}
#' Calculate standard error for given sample size, or vice versa. Exactly one of 'n' and 'se' has to be NULL
#' p - expected event probability
#' n - sample size
#' se - standard error of estimated probability
se_prop <- function(p, n=NULL, se=NULL){
  if (is.null(n) & !is.null(se)){
    n <- p * (1-p) / se^2
  } else if (!is.null(n) & is.null(se)){
    se <- sqrt(p*(1-p)/n)
  } else stop("Exactly one of 'n' and 'se' has to be NULL")
  
  res <- list(p = p, n = n, se = se)
  res
}

```

### Confidence interval 

Another way to quantify the precision of the estimated proportion is the width of the resulting two-sided confidence interval, usually at a 95% confidence level. The half of the width of a symmetric 95% confidence interval is also called the _margin of error_. There are several methods for estimating a confidence interval for a proportion, most of which resulting in non-symmetric intervals.

**Confidence interval methods**

| Method          | $100(1-\alpha)$% confidence interval | 
|:---------------|:-------------------------------------:|
| Wald           | $\Big(\hat{p} \pm z_*\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}\Big)$|
| Wilson         | $\Big(\hat{p}_{adj} \pm \frac{z_*}{1+z_*^2/n} \sqrt{\frac{\hat{p}(1-\hat{p})}{n} + \frac{z_*^2}{4n^2}}\Big)$|
| Exact binomial | $(b_{1-\frac{\alpha}{2}; n,\hat{p}}; b_{\frac{\alpha}{2}; n,\hat{p}})$|
| Agresti-Coull  |$(\hat{p}_{adj} \pm z_*\sqrt{p_{adj}(1-p_{adj})/n})$

where $\hat{p}_{adj} = \frac{X + 0.5z_*^2}{n + z_*^2}$, $b_{\frac{\alpha}{2}; n,p}$ is the upper $\frac{\alpha}{2}$th quantile of the $Binomial(n,p)$ distribution, $z_* = z_\frac{\alpha}{2}$ denotes the upper $\frac{\alpha}{2}$th quantile of the standard normal distribution, and $(a \pm d)$ is a shorthand for a symmetric confidence interval $(a-d, a+d)$ with margin of error $d$.

The calculation of the sample size `n` or the confidence interval width is implemented in the `presize` R package. [@R-presize; @presize2021]

```{r OnePropCI}
str(presize::prec_prop)
```


## Getting inputs, worst/best case scenarios

The only input needed is a best guess at $p$, the proportion to be estimated. 

```{r OneProp_PrecisionPlot}

```


## Example revisited 

## Simulation study

## Functions in R packages

