<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 One-sample proportion: power-based sample size | Power and Sample Size Manual</title>
  <meta name="description" content="This is a reference book for power and sample size calculations using R" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="3 One-sample proportion: power-based sample size | Power and Sample Size Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a reference book for power and sample size calculations using R" />
  <meta name="github-repo" content="anikoszabo/powerbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 One-sample proportion: power-based sample size | Power and Sample Size Manual" />
  
  <meta name="twitter:description" content="This is a reference book for power and sample size calculations using R" />
  

<meta name="author" content="Aniko Szabo" />


<meta name="date" content="2023-10-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="one-sample-proportion-precision-based-sample-size.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Power and Sample Size Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#guiding-principles"><i class="fa fa-check"></i>Guiding principles</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#basic-approach"><i class="fa fa-check"></i>Basic approach</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#coding-style"><i class="fa fa-check"></i>Coding style</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Analyzing population means</b></span></li>
<li class="chapter" data-level="1" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html"><i class="fa fa-check"></i><b>1</b> One-sample mean: precision-based sample size</a>
<ul>
<li class="chapter" data-level="1.1" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#example"><i class="fa fa-check"></i><b>1.1</b> Example</a></li>
<li class="chapter" data-level="1.2" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#data-generating-mechanism"><i class="fa fa-check"></i><b>1.2</b> Data generating mechanism</a></li>
<li class="chapter" data-level="1.3" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#precision-measures"><i class="fa fa-check"></i><b>1.3</b> Precision measures</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#standard-error"><i class="fa fa-check"></i><b>1.3.1</b> Standard error</a></li>
<li class="chapter" data-level="1.3.2" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#confidence-interval"><i class="fa fa-check"></i><b>1.3.2</b> Confidence Interval</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#simulation-study"><i class="fa fa-check"></i><b>1.4</b> Simulation study</a></li>
<li class="chapter" data-level="1.5" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#getting-inputs"><i class="fa fa-check"></i><b>1.5</b> Getting inputs</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#estimating-standard-deviation"><i class="fa fa-check"></i><b>1.5.1</b> Estimating Standard Deviation</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#example-revisited"><i class="fa fa-check"></i><b>1.6</b> Example revisited</a></li>
<li class="chapter" data-level="1.7" data-path="one-sample-mean-precision-based-sample-size.html"><a href="one-sample-mean-precision-based-sample-size.html#functions-in-r-packages"><i class="fa fa-check"></i><b>1.7</b> Functions in R packages</a></li>
</ul></li>
<li class="part"><span><b>II Analyzing population proportions</b></span></li>
<li class="chapter" data-level="2" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html"><i class="fa fa-check"></i><b>2</b> One-sample proportion: precision-based sample size</a>
<ul>
<li class="chapter" data-level="2.1" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#example-1"><i class="fa fa-check"></i><b>2.1</b> Example</a></li>
<li class="chapter" data-level="2.2" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#data-generating-mechanism-1"><i class="fa fa-check"></i><b>2.2</b> Data generating mechanism</a></li>
<li class="chapter" data-level="2.3" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#precision-measures-1"><i class="fa fa-check"></i><b>2.3</b> Precision measures</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#standard-error-1"><i class="fa fa-check"></i><b>2.3.1</b> Standard error</a></li>
<li class="chapter" data-level="2.3.2" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#confidence-interval-1"><i class="fa fa-check"></i><b>2.3.2</b> Confidence interval</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#getting-inputs-worstbest-case-scenarios"><i class="fa fa-check"></i><b>2.4</b> Getting inputs, worst/best case scenarios</a></li>
<li class="chapter" data-level="2.5" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#simulation-study-1"><i class="fa fa-check"></i><b>2.5</b> Simulation study</a></li>
<li class="chapter" data-level="2.6" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#example-revisited-1"><i class="fa fa-check"></i><b>2.6</b> Example revisited</a></li>
<li class="chapter" data-level="2.7" data-path="one-sample-proportion-precision-based-sample-size.html"><a href="one-sample-proportion-precision-based-sample-size.html#functions-in-r-packages-1"><i class="fa fa-check"></i><b>2.7</b> Functions in R packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html"><i class="fa fa-check"></i><b>3</b> One-sample proportion: power-based sample size</a>
<ul>
<li class="chapter" data-level="3.1" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#example-2"><i class="fa fa-check"></i><b>3.1</b> Example</a></li>
<li class="chapter" data-level="3.2" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#data-generating-mechanism-2"><i class="fa fa-check"></i><b>3.2</b> Data generating mechanism</a></li>
<li class="chapter" data-level="3.3" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#power-based-sample-size"><i class="fa fa-check"></i><b>3.3</b> Power-based sample size</a>
<ul>
<li class="chapter" data-level="" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#test-statistic"><i class="fa fa-check"></i>Test statistic</a></li>
<li class="chapter" data-level="" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#power-formula"><i class="fa fa-check"></i>Power formula</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#getting-inputs-worstbest-case-scenarios-1"><i class="fa fa-check"></i><b>3.4</b> Getting inputs, worst/best case scenarios</a></li>
<li class="chapter" data-level="3.5" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#simulation-studies"><i class="fa fa-check"></i><b>3.5</b> Simulation studies</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#achieved-power-when-calculating-sample-size"><i class="fa fa-check"></i><b>3.5.1</b> Achieved power when calculating sample size</a></li>
<li class="chapter" data-level="3.5.2" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#achieved-power-with-fixed-sample-size"><i class="fa fa-check"></i><b>3.5.2</b> Achieved power with fixed sample size</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#example-revisited-2"><i class="fa fa-check"></i><b>3.6</b> Example revisited</a></li>
<li class="chapter" data-level="3.7" data-path="one-sample-proportion-power-based-sample-size.html"><a href="one-sample-proportion-power-based-sample-size.html#functions-in-r-packages-2"><i class="fa fa-check"></i><b>3.7</b> Functions in R packages</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Power and Sample Size Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="one-sample-proportion-power-based-sample-size" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> One-sample proportion: power-based sample size<a href="one-sample-proportion-power-based-sample-size.html#one-sample-proportion-power-based-sample-size" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="example-2" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Example<a href="one-sample-proportion-power-based-sample-size.html#example-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An oncologist is developing a new treatment, and he wants to run a single arm phase II study to estimate the probability of response (partial or complete reduction in the size of the tumor) after four weeks of treatment. The current standard of care has a 30% response probability. How many subjects should he recruit?</p>
</div>
<div id="data-generating-mechanism-2" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Data generating mechanism<a href="one-sample-proportion-power-based-sample-size.html#data-generating-mechanism-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Independent identically distributed variables <span class="math inline">\(X_1, \ldots, X_n \sim Bernoulli(p)\)</span> with <span class="math inline">\(p\)</span>, the event probability as the parameter of interest.</p>
<p>It will be estimated as the sample proportion <span class="math inline">\(\hat{p} = \sum_{i=1}^n X_i / n\)</span>. Inference can be based on the exact distribution of <span class="math inline">\(X = \sum_{i=1}^n X_i \sim Binom(n,p)\)</span> or the asymptotic distribution of <span class="math inline">\(\hat{p} \sim N(p, \frac{p(1-p)}{n})\)</span>.</p>
</div>
<div id="power-based-sample-size" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Power-based sample size<a href="one-sample-proportion-power-based-sample-size.html#power-based-sample-size" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The sample size can also be based on the power to test, at a significance level <span class="math inline">\(\alpha\)</span>, the null hypothesis <span class="math inline">\(H_0: p = p_0\)</span> versus the two-sided alternative <span class="math inline">\(H_{a1}: p \neq p_0\)</span>, or the one-sided alternatives <span class="math inline">\(H_{a2}: p &gt; p_0\)</span> or <span class="math inline">\(H_{a3}: p &lt; p_0\)</span>.</p>
<div id="test-statistic" class="section level3 unnumbered hasAnchor">
<h3>Test statistic<a href="one-sample-proportion-power-based-sample-size.html#test-statistic" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are three commonly used tests:</p>
<ol style="list-style-type: decimal">
<li><strong>Exact binomial test</strong> with test statistic <span class="math inline">\(X = \sum_{i=1}^n X_i \sim Binom(n,p_0)\)</span> under <span class="math inline">\(H_0\)</span></li>
<li>One-sample <strong>Wald z-test</strong> with test statistic <span class="math inline">\(Z_W = \frac{\hat{p} - p_0}{\sqrt{\hat{p}(1-\hat{p})/n}} \approx N(0,1)\)</span> under <span class="math inline">\(H_0\)</span></li>
<li>One-sample <strong>Score z-test</strong> with test statistic <span class="math inline">\(Z_S = \frac{\hat{p} - p_0}{\sqrt{p_0(1-p_0)/n}} \approx N(0,1)\)</span> under <span class="math inline">\(H_0\)</span></li>
</ol>
<p><strong>Rejection regions for the tests</strong></p>
<table>
<colgroup>
<col width="21%" />
<col width="28%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Test</th>
<th align="center"><span class="math inline">\(H_{a1}: p \neq p_0\)</span></th>
<th align="center"><span class="math inline">\(H_{a2}: p &gt; p_0\)</span></th>
<th align="center"><span class="math inline">\(H_{a3}: p &lt; p_0\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Exact binomial</td>
<td align="center"><span class="math inline">\(X \geq b_{\frac{\alpha}{2}; n,p_0}\)</span> or <span class="math inline">\(X \leq b_{1-\frac{\alpha}{2}; n,p_0}\)</span></td>
<td align="center"><span class="math inline">\(X \geq b_{\alpha; n,p_0}\)</span></td>
<td align="center"><span class="math inline">\(X \leq b_{1-\alpha; n,p_0}\)</span></td>
</tr>
<tr class="even">
<td align="left">Wald z-test</td>
<td align="center"><span class="math inline">\(|Z_W| \geq z_\frac{\alpha}{2}\)</span></td>
<td align="center"><span class="math inline">\(Z_W \geq z_\alpha\)</span></td>
<td align="center"><span class="math inline">\(Z_W \leq -z_{\alpha}\)</span></td>
</tr>
<tr class="odd">
<td align="left">Score z-test</td>
<td align="center"><span class="math inline">\(|Z_S| \geq z_\frac{\alpha}{2}\)</span></td>
<td align="center"><span class="math inline">\(Z_S \geq z_\alpha\)</span></td>
<td align="center"><span class="math inline">\(Z_S \leq -z_{\alpha}\)</span></td>
</tr>
</tbody>
</table>
<p>where <span class="math inline">\(b_{\alpha; n,p_0}\)</span> is the upper <span class="math inline">\(\alpha\)</span>th quantile of the <span class="math inline">\(Binomial(n,p_0)\)</span> distribution, and <span class="math inline">\(z_{\alpha}\)</span> is the upper <span class="math inline">\(\alpha\)</span>th quantile of the <span class="math inline">\(N(0,1)\)</span> distribution.</p>
<p>The exact binomial test is implemented in R in <code>binom.test</code>, the score test in <code>prop.test</code> (with or without continuity correction). The Wald test is not implemented in base R. The following function implements them in a unified framework to simplify the simulation study, without the option for continuity correction (see, for example, <a href="http://www.how2stats.net/2011/09/yates-correction.html" class="uri">http://www.how2stats.net/2011/09/yates-correction.html</a> for an explanation).</p>
<!-- Thompson, B. (1988). Misuse of chi-square contingency-table test statistics. Educational and Psychological Research, 8(1), 39-49. -->
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="one-sample-proportion-power-based-sample-size.html#cb18-1" tabindex="-1"></a><span class="co"># alternative</span></span>
<span id="cb18-2"><a href="one-sample-proportion-power-based-sample-size.html#cb18-2" tabindex="-1"></a><span class="co"># conf.level</span></span>
<span id="cb18-3"><a href="one-sample-proportion-power-based-sample-size.html#cb18-3" tabindex="-1"></a><span class="co"># correct=FALSE</span></span>
<span id="cb18-4"><a href="one-sample-proportion-power-based-sample-size.html#cb18-4" tabindex="-1"></a><span class="co"># suppresses warnings, changes chi-squared to Z in the Wald test output</span></span>
<span id="cb18-5"><a href="one-sample-proportion-power-based-sample-size.html#cb18-5" tabindex="-1"></a>one_prop_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n, p0, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;binomial&quot;</span>, <span class="st">&quot;Wald&quot;</span>,<span class="st">&quot;score&quot;</span>), </span>
<span id="cb18-6"><a href="one-sample-proportion-power-based-sample-size.html#cb18-6" tabindex="-1"></a>                          <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">&quot;two.sided&quot;</span>, <span class="st">&quot;less&quot;</span>,  <span class="st">&quot;greater&quot;</span>), </span>
<span id="cb18-7"><a href="one-sample-proportion-power-based-sample-size.html#cb18-7" tabindex="-1"></a>                          <span class="at">conf.level =</span> <span class="fl">0.95</span>){</span>
<span id="cb18-8"><a href="one-sample-proportion-power-based-sample-size.html#cb18-8" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">!=</span><span class="dv">1</span> <span class="sc">|</span> <span class="fu">length</span>(n) <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">length</span>(p0) <span class="sc">!=</span> <span class="dv">1</span>)</span>
<span id="cb18-9"><a href="one-sample-proportion-power-based-sample-size.html#cb18-9" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;x, n, and p0 all should be scalars, not vectors&quot;</span>)</span>
<span id="cb18-10"><a href="one-sample-proportion-power-based-sample-size.html#cb18-10" tabindex="-1"></a>  </span>
<span id="cb18-11"><a href="one-sample-proportion-power-based-sample-size.html#cb18-11" tabindex="-1"></a>  method <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(method)</span>
<span id="cb18-12"><a href="one-sample-proportion-power-based-sample-size.html#cb18-12" tabindex="-1"></a>  alternative <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(alternative)</span>
<span id="cb18-13"><a href="one-sample-proportion-power-based-sample-size.html#cb18-13" tabindex="-1"></a>  </span>
<span id="cb18-14"><a href="one-sample-proportion-power-based-sample-size.html#cb18-14" tabindex="-1"></a>  <span class="cf">if</span> (method <span class="sc">==</span> <span class="st">&quot;binomial&quot;</span>){</span>
<span id="cb18-15"><a href="one-sample-proportion-power-based-sample-size.html#cb18-15" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">binom.test</span>(<span class="at">x=</span>x, <span class="at">n=</span>n, <span class="at">p=</span>p0, <span class="at">alternative=</span>alternative, <span class="at">conf.level=</span>conf.level)</span>
<span id="cb18-16"><a href="one-sample-proportion-power-based-sample-size.html#cb18-16" tabindex="-1"></a>  } <span class="cf">else</span></span>
<span id="cb18-17"><a href="one-sample-proportion-power-based-sample-size.html#cb18-17" tabindex="-1"></a>  <span class="cf">if</span> (method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Wald&quot;</span>, <span class="st">&quot;score&quot;</span>)){</span>
<span id="cb18-18"><a href="one-sample-proportion-power-based-sample-size.html#cb18-18" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>(</span>
<span id="cb18-19"><a href="one-sample-proportion-power-based-sample-size.html#cb18-19" tabindex="-1"></a>      res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span>x, <span class="at">n=</span>n, <span class="at">p=</span>p0, <span class="at">alternative=</span>alternative, <span class="at">conf.level=</span>conf.level,</span>
<span id="cb18-20"><a href="one-sample-proportion-power-based-sample-size.html#cb18-20" tabindex="-1"></a>                       <span class="at">correct =</span> <span class="cn">FALSE</span>))</span>
<span id="cb18-21"><a href="one-sample-proportion-power-based-sample-size.html#cb18-21" tabindex="-1"></a>    phat <span class="ot">&lt;-</span> res<span class="sc">$</span>estimate</span>
<span id="cb18-22"><a href="one-sample-proportion-power-based-sample-size.html#cb18-22" tabindex="-1"></a>     </span>
<span id="cb18-23"><a href="one-sample-proportion-power-based-sample-size.html#cb18-23" tabindex="-1"></a>    <span class="cf">if</span> (method <span class="sc">==</span> <span class="st">&quot;score&quot;</span>){</span>
<span id="cb18-24"><a href="one-sample-proportion-power-based-sample-size.html#cb18-24" tabindex="-1"></a>      z.sign <span class="ot">&lt;-</span> <span class="fu">sign</span>(phat <span class="sc">-</span> p0)</span>
<span id="cb18-25"><a href="one-sample-proportion-power-based-sample-size.html#cb18-25" tabindex="-1"></a>      Z <span class="ot">&lt;-</span> z.sign <span class="sc">*</span> <span class="fu">sqrt</span>(res<span class="sc">$</span>statistic)</span>
<span id="cb18-26"><a href="one-sample-proportion-power-based-sample-size.html#cb18-26" tabindex="-1"></a>      <span class="fu">names</span>(Z) <span class="ot">&lt;-</span> <span class="st">&quot;Z&quot;</span></span>
<span id="cb18-27"><a href="one-sample-proportion-power-based-sample-size.html#cb18-27" tabindex="-1"></a>      res<span class="sc">$</span>statistic <span class="ot">&lt;-</span> Z</span>
<span id="cb18-28"><a href="one-sample-proportion-power-based-sample-size.html#cb18-28" tabindex="-1"></a>      res<span class="sc">$</span>parameter <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-29"><a href="one-sample-proportion-power-based-sample-size.html#cb18-29" tabindex="-1"></a>      res<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="st">&quot;1-sample proportions score test&quot;</span></span>
<span id="cb18-30"><a href="one-sample-proportion-power-based-sample-size.html#cb18-30" tabindex="-1"></a>    } <span class="cf">else</span> {  <span class="co">#Wald</span></span>
<span id="cb18-31"><a href="one-sample-proportion-power-based-sample-size.html#cb18-31" tabindex="-1"></a>      Z <span class="ot">&lt;-</span> (phat <span class="sc">-</span> p0) <span class="sc">*</span><span class="fu">sqrt</span>(n) <span class="sc">/</span> <span class="fu">sqrt</span>(phat<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>phat))</span>
<span id="cb18-32"><a href="one-sample-proportion-power-based-sample-size.html#cb18-32" tabindex="-1"></a>      <span class="fu">names</span>(Z) <span class="ot">&lt;-</span> <span class="st">&quot;Z&quot;</span></span>
<span id="cb18-33"><a href="one-sample-proportion-power-based-sample-size.html#cb18-33" tabindex="-1"></a>      <span class="co"># p-value</span></span>
<span id="cb18-34"><a href="one-sample-proportion-power-based-sample-size.html#cb18-34" tabindex="-1"></a>      pval <span class="ot">&lt;-</span> <span class="cf">switch</span>(alternative,</span>
<span id="cb18-35"><a href="one-sample-proportion-power-based-sample-size.html#cb18-35" tabindex="-1"></a>                     <span class="at">two.sided =</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(Z), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>) <span class="sc">*</span> <span class="dv">2</span>,</span>
<span id="cb18-36"><a href="one-sample-proportion-power-based-sample-size.html#cb18-36" tabindex="-1"></a>                     <span class="at">greater =</span> <span class="fu">pnorm</span>(Z, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>),</span>
<span id="cb18-37"><a href="one-sample-proportion-power-based-sample-size.html#cb18-37" tabindex="-1"></a>                     <span class="at">less =</span> <span class="fu">pnorm</span>(Z, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-38"><a href="one-sample-proportion-power-based-sample-size.html#cb18-38" tabindex="-1"></a>      <span class="co"># confidence interval</span></span>
<span id="cb18-39"><a href="one-sample-proportion-power-based-sample-size.html#cb18-39" tabindex="-1"></a>      za <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="cf">if</span> (alternative <span class="sc">==</span> <span class="st">&quot;two.sided&quot;</span>) </span>
<span id="cb18-40"><a href="one-sample-proportion-power-based-sample-size.html#cb18-40" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">+</span> conf.level)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb18-41"><a href="one-sample-proportion-power-based-sample-size.html#cb18-41" tabindex="-1"></a>        <span class="cf">else</span> conf.level)</span>
<span id="cb18-42"><a href="one-sample-proportion-power-based-sample-size.html#cb18-42" tabindex="-1"></a>      ci.half <span class="ot">&lt;-</span> za <span class="sc">*</span> <span class="fu">sqrt</span>(phat<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>phat)<span class="sc">/</span>n)</span>
<span id="cb18-43"><a href="one-sample-proportion-power-based-sample-size.html#cb18-43" tabindex="-1"></a>      p.u <span class="ot">&lt;-</span> phat <span class="sc">+</span> ci.half</span>
<span id="cb18-44"><a href="one-sample-proportion-power-based-sample-size.html#cb18-44" tabindex="-1"></a>      p.l <span class="ot">&lt;-</span> phat <span class="sc">-</span> ci.half</span>
<span id="cb18-45"><a href="one-sample-proportion-power-based-sample-size.html#cb18-45" tabindex="-1"></a>      CINT <span class="ot">&lt;-</span> <span class="cf">switch</span>(alternative, </span>
<span id="cb18-46"><a href="one-sample-proportion-power-based-sample-size.html#cb18-46" tabindex="-1"></a>                     <span class="at">two.sided =</span> <span class="fu">c</span>(<span class="fu">max</span>(p.l, <span class="dv">0</span>), <span class="fu">min</span>(p.u, <span class="dv">1</span>)), </span>
<span id="cb18-47"><a href="one-sample-proportion-power-based-sample-size.html#cb18-47" tabindex="-1"></a>                     <span class="at">greater =</span> <span class="fu">c</span>(<span class="fu">max</span>(p.l, <span class="dv">0</span>), <span class="dv">1</span>), </span>
<span id="cb18-48"><a href="one-sample-proportion-power-based-sample-size.html#cb18-48" tabindex="-1"></a>                     <span class="at">less =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">min</span>(p.u, <span class="dv">1</span>)))</span>
<span id="cb18-49"><a href="one-sample-proportion-power-based-sample-size.html#cb18-49" tabindex="-1"></a>     <span class="co"># change recalculated parts</span></span>
<span id="cb18-50"><a href="one-sample-proportion-power-based-sample-size.html#cb18-50" tabindex="-1"></a>      res<span class="sc">$</span>statistic <span class="ot">&lt;-</span> Z</span>
<span id="cb18-51"><a href="one-sample-proportion-power-based-sample-size.html#cb18-51" tabindex="-1"></a>      res<span class="sc">$</span>parameter <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-52"><a href="one-sample-proportion-power-based-sample-size.html#cb18-52" tabindex="-1"></a>      res<span class="sc">$</span>p.value <span class="ot">&lt;-</span> pval</span>
<span id="cb18-53"><a href="one-sample-proportion-power-based-sample-size.html#cb18-53" tabindex="-1"></a>      res<span class="sc">$</span>conf.int <span class="ot">&lt;-</span> CINT</span>
<span id="cb18-54"><a href="one-sample-proportion-power-based-sample-size.html#cb18-54" tabindex="-1"></a>      res<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="st">&quot;1-sample proportions Wald test&quot;</span></span>
<span id="cb18-55"><a href="one-sample-proportion-power-based-sample-size.html#cb18-55" tabindex="-1"></a>    }</span>
<span id="cb18-56"><a href="one-sample-proportion-power-based-sample-size.html#cb18-56" tabindex="-1"></a>  }  </span>
<span id="cb18-57"><a href="one-sample-proportion-power-based-sample-size.html#cb18-57" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb18-58"><a href="one-sample-proportion-power-based-sample-size.html#cb18-58" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="power-formula" class="section level3 unnumbered hasAnchor">
<h3>Power formula<a href="one-sample-proportion-power-based-sample-size.html#power-formula" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The power for a specific alternative <span class="math inline">\(p=p_1\)</span> are shown for the one-sided alternative hypothesis <span class="math inline">\(H_{a2}\)</span>. The formula for <span class="math inline">\(H_{a3}\)</span> is a straightforward modification (using <span class="math inline">\(p_{0-}\)</span> for the Wald test), while the power for the two-sided hypothesis is the sum of the powers for the two one-sided hypotheses using <span class="math inline">\(\alpha/2\)</span> instead of <span class="math inline">\(\alpha\)</span>.</p>
<p><strong>Power for the tests</strong></p>
<table>
<colgroup>
<col width="29%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Test</th>
<th align="center">Prob(rejecting <span class="math inline">\(H_0\)</span> versus <span class="math inline">\(H_{a2}\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Exact binomial</td>
<td align="center"><span class="math inline">\(1 - F_{B(n,p_1)}(b_{\frac{\alpha}{2}; n,p_0})\)</span></td>
</tr>
<tr class="even">
<td align="left">Wald z-test</td>
<td align="center"><span class="math inline">\(1 - \Phi\Big(\frac{p_{0+} - p_1}{\sqrt{p_1(1-p_1)/n}}\Big)\)</span></td>
</tr>
<tr class="odd">
<td align="left">Score z-test</td>
<td align="center"><span class="math inline">\(1 - \Phi\Big(\frac{p_{0} + z_\alpha\sqrt{p_0(1-p_0)/n} - p_1}{\sqrt{p_1(1-p_1)/n}}\Big)\)</span></td>
</tr>
</tbody>
</table>
<p>where <span class="math inline">\(F_{B(n,p)}\)</span> is the cdf of the <span class="math inline">\(Binomial(n,p)\)</span> distribution, <span class="math inline">\(\Phi\)</span> is the cdf of the <span class="math inline">\(N(0,1)\)</span> distribution, <span class="math inline">\(p_{0\pm}= \frac{np_0 + 0.5z_\alpha^2}{n + z_\alpha^2} \pm \frac{n z_\alpha}{n+z_\alpha^2} \sqrt{\frac{p_0(1-p_0)}{n} + \frac{z_\alpha^2}{4n^2}}\)</span> .</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="one-sample-proportion-power-based-sample-size.html#cb19-1" tabindex="-1"></a><span class="co">#&#39; Calculate power for given sample size, or vice versa. Exactly one of &#39;n&#39; and &#39;power&#39; has to be NULL</span></span>
<span id="cb19-2"><a href="one-sample-proportion-power-based-sample-size.html#cb19-2" tabindex="-1"></a><span class="co">#&#39; p0 - null hypothesis event probability</span></span>
<span id="cb19-3"><a href="one-sample-proportion-power-based-sample-size.html#cb19-3" tabindex="-1"></a><span class="co">#&#39; p1 - alternative hypothesis event probability</span></span>
<span id="cb19-4"><a href="one-sample-proportion-power-based-sample-size.html#cb19-4" tabindex="-1"></a><span class="co">#&#39; n - sample size</span></span>
<span id="cb19-5"><a href="one-sample-proportion-power-based-sample-size.html#cb19-5" tabindex="-1"></a><span class="co">#&#39; power - power to reject the null hypothesis</span></span>
<span id="cb19-6"><a href="one-sample-proportion-power-based-sample-size.html#cb19-6" tabindex="-1"></a><span class="co">#&#39; sig.level - significance level of test</span></span>
<span id="cb19-7"><a href="one-sample-proportion-power-based-sample-size.html#cb19-7" tabindex="-1"></a><span class="co">#&#39; alternative - type of alternative hypothesis</span></span>
<span id="cb19-8"><a href="one-sample-proportion-power-based-sample-size.html#cb19-8" tabindex="-1"></a><span class="co">#&#39; test - type of test</span></span>
<span id="cb19-9"><a href="one-sample-proportion-power-based-sample-size.html#cb19-9" tabindex="-1"></a>power_one_prop_test <span class="ot">&lt;-</span> <span class="cf">function</span>(p, p0, <span class="at">n=</span><span class="cn">NULL</span>, <span class="at">power=</span><span class="cn">NULL</span>, <span class="at">sig.level=</span><span class="fl">0.05</span>, </span>
<span id="cb19-10"><a href="one-sample-proportion-power-based-sample-size.html#cb19-10" tabindex="-1"></a>                             <span class="at">alternative=</span><span class="fu">c</span>(<span class="st">&quot;two.sided&quot;</span>,<span class="st">&quot;less&quot;</span>,<span class="st">&quot;greater&quot;</span>),</span>
<span id="cb19-11"><a href="one-sample-proportion-power-based-sample-size.html#cb19-11" tabindex="-1"></a>                             <span class="at">test =</span> <span class="fu">c</span>(<span class="st">&quot;binomial&quot;</span>,<span class="st">&quot;Wald&quot;</span>,<span class="st">&quot;score&quot;</span>)){</span>
<span id="cb19-12"><a href="one-sample-proportion-power-based-sample-size.html#cb19-12" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(power) <span class="sc">+</span> <span class="fu">is.null</span>(n) <span class="sc">!=</span> <span class="dv">1</span>){</span>
<span id="cb19-13"><a href="one-sample-proportion-power-based-sample-size.html#cb19-13" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Exactly one of &#39;n&#39; and &#39;power&#39; should be non-NULL&quot;</span>)</span>
<span id="cb19-14"><a href="one-sample-proportion-power-based-sample-size.html#cb19-14" tabindex="-1"></a>  }</span>
<span id="cb19-15"><a href="one-sample-proportion-power-based-sample-size.html#cb19-15" tabindex="-1"></a>    </span>
<span id="cb19-16"><a href="one-sample-proportion-power-based-sample-size.html#cb19-16" tabindex="-1"></a>  alternative <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(alternative)</span>
<span id="cb19-17"><a href="one-sample-proportion-power-based-sample-size.html#cb19-17" tabindex="-1"></a>  sides <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(alternative<span class="sc">==</span><span class="st">&quot;two.sided&quot;</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb19-18"><a href="one-sample-proportion-power-based-sample-size.html#cb19-18" tabindex="-1"></a>  </span>
<span id="cb19-19"><a href="one-sample-proportion-power-based-sample-size.html#cb19-19" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(test)</span>
<span id="cb19-20"><a href="one-sample-proportion-power-based-sample-size.html#cb19-20" tabindex="-1"></a>  </span>
<span id="cb19-21"><a href="one-sample-proportion-power-based-sample-size.html#cb19-21" tabindex="-1"></a>  <span class="cf">if</span> (test <span class="sc">==</span> <span class="st">&quot;binomial&quot;</span>){</span>
<span id="cb19-22"><a href="one-sample-proportion-power-based-sample-size.html#cb19-22" tabindex="-1"></a>    p.body.up <span class="ot">&lt;-</span> <span class="fu">quote</span>({</span>
<span id="cb19-23"><a href="one-sample-proportion-power-based-sample-size.html#cb19-23" tabindex="-1"></a>      ba <span class="ot">&lt;-</span> <span class="fu">qbinom</span>(sig.level<span class="sc">/</span>sides, <span class="at">size =</span> n, <span class="at">prob=</span>p0, <span class="at">lower.tail=</span><span class="cn">FALSE</span>)</span>
<span id="cb19-24"><a href="one-sample-proportion-power-based-sample-size.html#cb19-24" tabindex="-1"></a>      <span class="fu">pbinom</span>(ba, <span class="at">size=</span>n, <span class="at">prob=</span>p, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)})</span>
<span id="cb19-25"><a href="one-sample-proportion-power-based-sample-size.html#cb19-25" tabindex="-1"></a>    p.body.lo <span class="ot">&lt;-</span> <span class="fu">quote</span>({</span>
<span id="cb19-26"><a href="one-sample-proportion-power-based-sample-size.html#cb19-26" tabindex="-1"></a>      ba <span class="ot">&lt;-</span> <span class="fu">qbinom</span>(sig.level<span class="sc">/</span>sides, <span class="at">size =</span> n, <span class="at">prob=</span>p0, <span class="at">lower.tail=</span><span class="cn">TRUE</span>)</span>
<span id="cb19-27"><a href="one-sample-proportion-power-based-sample-size.html#cb19-27" tabindex="-1"></a>      <span class="fu">pbinom</span>(ba<span class="dv">-1</span>, <span class="at">size=</span>n, <span class="at">prob=</span>p, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)})</span>
<span id="cb19-28"><a href="one-sample-proportion-power-based-sample-size.html#cb19-28" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (test <span class="sc">==</span> <span class="st">&quot;score&quot;</span>){</span>
<span id="cb19-29"><a href="one-sample-proportion-power-based-sample-size.html#cb19-29" tabindex="-1"></a>    za <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(sig.level<span class="sc">/</span>sides, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-30"><a href="one-sample-proportion-power-based-sample-size.html#cb19-30" tabindex="-1"></a>    vratio <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(p0 <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p0) <span class="sc">/</span> (p <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p)))</span>
<span id="cb19-31"><a href="one-sample-proportion-power-based-sample-size.html#cb19-31" tabindex="-1"></a>    delta <span class="ot">&lt;-</span> (p <span class="sc">-</span> p0) <span class="sc">/</span> <span class="fu">sqrt</span>(p <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p))</span>
<span id="cb19-32"><a href="one-sample-proportion-power-based-sample-size.html#cb19-32" tabindex="-1"></a>    </span>
<span id="cb19-33"><a href="one-sample-proportion-power-based-sample-size.html#cb19-33" tabindex="-1"></a>    p.body.up  <span class="ot">&lt;-</span> <span class="fu">quote</span>({</span>
<span id="cb19-34"><a href="one-sample-proportion-power-based-sample-size.html#cb19-34" tabindex="-1"></a>      <span class="fu">pnorm</span>(za <span class="sc">*</span> vratio <span class="sc">+</span> delta <span class="sc">*</span> <span class="fu">sqrt</span>(n), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-35"><a href="one-sample-proportion-power-based-sample-size.html#cb19-35" tabindex="-1"></a>    })</span>
<span id="cb19-36"><a href="one-sample-proportion-power-based-sample-size.html#cb19-36" tabindex="-1"></a>    p.body.lo  <span class="ot">&lt;-</span> <span class="fu">quote</span>({</span>
<span id="cb19-37"><a href="one-sample-proportion-power-based-sample-size.html#cb19-37" tabindex="-1"></a>      <span class="fu">pnorm</span>(<span class="sc">-</span>za <span class="sc">*</span> vratio <span class="sc">+</span> delta <span class="sc">*</span> <span class="fu">sqrt</span>(n), <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-38"><a href="one-sample-proportion-power-based-sample-size.html#cb19-38" tabindex="-1"></a>    })</span>
<span id="cb19-39"><a href="one-sample-proportion-power-based-sample-size.html#cb19-39" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (test <span class="sc">==</span> <span class="st">&quot;Wald&quot;</span>) {</span>
<span id="cb19-40"><a href="one-sample-proportion-power-based-sample-size.html#cb19-40" tabindex="-1"></a>    za <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(sig.level<span class="sc">/</span>sides, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-41"><a href="one-sample-proportion-power-based-sample-size.html#cb19-41" tabindex="-1"></a>    za2 <span class="ot">&lt;-</span> za<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb19-42"><a href="one-sample-proportion-power-based-sample-size.html#cb19-42" tabindex="-1"></a>    v0 <span class="ot">&lt;-</span> p0 <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p0)</span>
<span id="cb19-43"><a href="one-sample-proportion-power-based-sample-size.html#cb19-43" tabindex="-1"></a>    v <span class="ot">&lt;-</span> p <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb19-44"><a href="one-sample-proportion-power-based-sample-size.html#cb19-44" tabindex="-1"></a>    p.body.up  <span class="ot">&lt;-</span> <span class="fu">quote</span>({</span>
<span id="cb19-45"><a href="one-sample-proportion-power-based-sample-size.html#cb19-45" tabindex="-1"></a>      padj <span class="ot">&lt;-</span> (n<span class="sc">*</span>p0 <span class="sc">+</span> za2<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span> (n <span class="sc">+</span> za2)</span>
<span id="cb19-46"><a href="one-sample-proportion-power-based-sample-size.html#cb19-46" tabindex="-1"></a>      w <span class="ot">&lt;-</span>  n <span class="sc">*</span> za <span class="sc">*</span> <span class="fu">sqrt</span>(v0<span class="sc">/</span>n <span class="sc">+</span> za2<span class="sc">/</span>(<span class="dv">4</span><span class="sc">*</span>n<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">/</span> (n <span class="sc">+</span> za2)</span>
<span id="cb19-47"><a href="one-sample-proportion-power-based-sample-size.html#cb19-47" tabindex="-1"></a>      <span class="fu">pnorm</span>((padj <span class="sc">+</span> w <span class="sc">-</span> p)<span class="sc">/</span><span class="fu">sqrt</span>(v<span class="sc">/</span>n), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-48"><a href="one-sample-proportion-power-based-sample-size.html#cb19-48" tabindex="-1"></a>    })</span>
<span id="cb19-49"><a href="one-sample-proportion-power-based-sample-size.html#cb19-49" tabindex="-1"></a>    p.body.lo  <span class="ot">&lt;-</span> <span class="fu">quote</span>({</span>
<span id="cb19-50"><a href="one-sample-proportion-power-based-sample-size.html#cb19-50" tabindex="-1"></a>      padj <span class="ot">&lt;-</span> (n<span class="sc">*</span>p0 <span class="sc">+</span> za2<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span> (n <span class="sc">+</span> za2)</span>
<span id="cb19-51"><a href="one-sample-proportion-power-based-sample-size.html#cb19-51" tabindex="-1"></a>      w <span class="ot">&lt;-</span>  n <span class="sc">*</span> za <span class="sc">*</span> <span class="fu">sqrt</span>(v0<span class="sc">/</span>n <span class="sc">+</span> za2<span class="sc">/</span>(<span class="dv">4</span><span class="sc">*</span>n<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">/</span> (n <span class="sc">+</span> za2)</span>
<span id="cb19-52"><a href="one-sample-proportion-power-based-sample-size.html#cb19-52" tabindex="-1"></a>      <span class="fu">pnorm</span>((padj <span class="sc">-</span> w <span class="sc">-</span> p)<span class="sc">/</span><span class="fu">sqrt</span>(v<span class="sc">/</span>n), <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-53"><a href="one-sample-proportion-power-based-sample-size.html#cb19-53" tabindex="-1"></a>    })</span>
<span id="cb19-54"><a href="one-sample-proportion-power-based-sample-size.html#cb19-54" tabindex="-1"></a>   </span>
<span id="cb19-55"><a href="one-sample-proportion-power-based-sample-size.html#cb19-55" tabindex="-1"></a>  }</span>
<span id="cb19-56"><a href="one-sample-proportion-power-based-sample-size.html#cb19-56" tabindex="-1"></a>  </span>
<span id="cb19-57"><a href="one-sample-proportion-power-based-sample-size.html#cb19-57" tabindex="-1"></a>  </span>
<span id="cb19-58"><a href="one-sample-proportion-power-based-sample-size.html#cb19-58" tabindex="-1"></a>  p.body <span class="ot">&lt;-</span> <span class="cf">if</span> (alternative<span class="sc">==</span><span class="st">&quot;two.sided&quot;</span>)</span>
<span id="cb19-59"><a href="one-sample-proportion-power-based-sample-size.html#cb19-59" tabindex="-1"></a>    <span class="fu">call</span>(<span class="st">&quot;+&quot;</span>, p.body.lo, p.body.up)</span>
<span id="cb19-60"><a href="one-sample-proportion-power-based-sample-size.html#cb19-60" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (alternative<span class="sc">==</span><span class="st">&quot;greater&quot;</span>)</span>
<span id="cb19-61"><a href="one-sample-proportion-power-based-sample-size.html#cb19-61" tabindex="-1"></a>    p.body.up</span>
<span id="cb19-62"><a href="one-sample-proportion-power-based-sample-size.html#cb19-62" tabindex="-1"></a>  <span class="cf">else</span> </span>
<span id="cb19-63"><a href="one-sample-proportion-power-based-sample-size.html#cb19-63" tabindex="-1"></a>    p.body.lo</span>
<span id="cb19-64"><a href="one-sample-proportion-power-based-sample-size.html#cb19-64" tabindex="-1"></a>  </span>
<span id="cb19-65"><a href="one-sample-proportion-power-based-sample-size.html#cb19-65" tabindex="-1"></a>  </span>
<span id="cb19-66"><a href="one-sample-proportion-power-based-sample-size.html#cb19-66" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(power) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(n)){</span>
<span id="cb19-67"><a href="one-sample-proportion-power-based-sample-size.html#cb19-67" tabindex="-1"></a>    power <span class="ot">&lt;-</span> <span class="fu">eval</span>(p.body)</span>
<span id="cb19-68"><a href="one-sample-proportion-power-based-sample-size.html#cb19-68" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(power) <span class="sc">&amp;</span> <span class="fu">is.null</span>(n)){</span>
<span id="cb19-69"><a href="one-sample-proportion-power-based-sample-size.html#cb19-69" tabindex="-1"></a>    <span class="cf">if</span> (test <span class="sc">==</span> <span class="st">&quot;binomial&quot;</span>){</span>
<span id="cb19-70"><a href="one-sample-proportion-power-based-sample-size.html#cb19-70" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-71"><a href="one-sample-proportion-power-based-sample-size.html#cb19-71" tabindex="-1"></a>      found <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb19-72"><a href="one-sample-proportion-power-based-sample-size.html#cb19-72" tabindex="-1"></a>      <span class="cf">while</span> (<span class="sc">!</span>found <span class="sc">&amp;</span> n <span class="sc">&lt;=</span> <span class="fl">1e+7</span>){</span>
<span id="cb19-73"><a href="one-sample-proportion-power-based-sample-size.html#cb19-73" tabindex="-1"></a>        n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb19-74"><a href="one-sample-proportion-power-based-sample-size.html#cb19-74" tabindex="-1"></a>        pw <span class="ot">&lt;-</span> <span class="fu">eval</span>(p.body)</span>
<span id="cb19-75"><a href="one-sample-proportion-power-based-sample-size.html#cb19-75" tabindex="-1"></a>        found <span class="ot">&lt;-</span> (pw <span class="sc">&gt;=</span> power) </span>
<span id="cb19-76"><a href="one-sample-proportion-power-based-sample-size.html#cb19-76" tabindex="-1"></a>      }</span>
<span id="cb19-77"><a href="one-sample-proportion-power-based-sample-size.html#cb19-77" tabindex="-1"></a>      power <span class="ot">&lt;-</span> pw</span>
<span id="cb19-78"><a href="one-sample-proportion-power-based-sample-size.html#cb19-78" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-79"><a href="one-sample-proportion-power-based-sample-size.html#cb19-79" tabindex="-1"></a>      f <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {<span class="fu">eval</span>(p.body) <span class="sc">-</span> power}</span>
<span id="cb19-80"><a href="one-sample-proportion-power-based-sample-size.html#cb19-80" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">f</span>(<span class="dv">1</span>) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb19-81"><a href="one-sample-proportion-power-based-sample-size.html#cb19-81" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb19-82"><a href="one-sample-proportion-power-based-sample-size.html#cb19-82" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb19-83"><a href="one-sample-proportion-power-based-sample-size.html#cb19-83" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(f, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1e+07</span>), </span>
<span id="cb19-84"><a href="one-sample-proportion-power-based-sample-size.html#cb19-84" tabindex="-1"></a>                    <span class="at">tol =</span> .Machine<span class="sc">$</span>double.eps<span class="sc">^</span><span class="fl">0.25</span>, <span class="at">extendInt =</span> <span class="st">&quot;upX&quot;</span>)<span class="sc">$</span>root</span>
<span id="cb19-85"><a href="one-sample-proportion-power-based-sample-size.html#cb19-85" tabindex="-1"></a>      }</span>
<span id="cb19-86"><a href="one-sample-proportion-power-based-sample-size.html#cb19-86" tabindex="-1"></a>    }</span>
<span id="cb19-87"><a href="one-sample-proportion-power-based-sample-size.html#cb19-87" tabindex="-1"></a>  }</span>
<span id="cb19-88"><a href="one-sample-proportion-power-based-sample-size.html#cb19-88" tabindex="-1"></a></span>
<span id="cb19-89"><a href="one-sample-proportion-power-based-sample-size.html#cb19-89" tabindex="-1"></a>  METHOD <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb19-90"><a href="one-sample-proportion-power-based-sample-size.html#cb19-90" tabindex="-1"></a>    <span class="cf">switch</span>(test, <span class="at">Wald =</span> <span class="st">&quot;Wald z&quot;</span>, <span class="at">score =</span> <span class="st">&quot;Score z&quot;</span>, <span class="at">binomial =</span> <span class="st">&quot;Exact binomial&quot;</span>),</span>
<span id="cb19-91"><a href="one-sample-proportion-power-based-sample-size.html#cb19-91" tabindex="-1"></a>    <span class="st">&quot;test power calculation&quot;</span>)</span>
<span id="cb19-92"><a href="one-sample-proportion-power-based-sample-size.html#cb19-92" tabindex="-1"></a>    </span>
<span id="cb19-93"><a href="one-sample-proportion-power-based-sample-size.html#cb19-93" tabindex="-1"></a>  <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">n =</span> n, <span class="at">p0 =</span> p0, <span class="at">p =</span> p, <span class="at">sig.level =</span> sig.level, </span>
<span id="cb19-94"><a href="one-sample-proportion-power-based-sample-size.html#cb19-94" tabindex="-1"></a>        <span class="at">power =</span> power, <span class="at">alternative =</span> alternative, <span class="at">note =</span> <span class="st">&quot;n is the number of independent samples&quot;</span>, </span>
<span id="cb19-95"><a href="one-sample-proportion-power-based-sample-size.html#cb19-95" tabindex="-1"></a>        <span class="at">method =</span> METHOD), <span class="at">class =</span> <span class="st">&quot;power.htest&quot;</span>)</span>
<span id="cb19-96"><a href="one-sample-proportion-power-based-sample-size.html#cb19-96" tabindex="-1"></a>  </span>
<span id="cb19-97"><a href="one-sample-proportion-power-based-sample-size.html#cb19-97" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="getting-inputs-worstbest-case-scenarios-1" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Getting inputs, worst/best case scenarios<a href="one-sample-proportion-power-based-sample-size.html#getting-inputs-worstbest-case-scenarios-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The inputs needed to calculate the sample size are</p>
<ul>
<li>a best guess at <span class="math inline">\(p\)</span>, the true value of the proportion to be tested</li>
<li>the desired power of the study</li>
<li>the test to be used</li>
</ul>
<p>The following plot shows how the sample size depends on these inputs. The y-axis is on a log-scale, so that the very large sample sizes dont dominate the plot.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="one-sample-proportion-power-based-sample-size.html#cb20-1" tabindex="-1"></a><span class="co"># set vector of &#39;p0&#39;, &#39;p&#39; &amp; &#39;power&#39; values to explore</span></span>
<span id="cb20-2"><a href="one-sample-proportion-power-based-sample-size.html#cb20-2" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>)</span>
<span id="cb20-3"><a href="one-sample-proportion-power-based-sample-size.html#cb20-3" tabindex="-1"></a>d0 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.15</span>,<span class="fl">0.15</span>, <span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb20-4"><a href="one-sample-proportion-power-based-sample-size.html#cb20-4" tabindex="-1"></a>pw0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.95</span>)</span>
<span id="cb20-5"><a href="one-sample-proportion-power-based-sample-size.html#cb20-5" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Wald&quot;</span>, <span class="st">&quot;score&quot;</span>, <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb20-6"><a href="one-sample-proportion-power-based-sample-size.html#cb20-6" tabindex="-1"></a><span class="co"># Data set with varying &#39;p&#39; and &#39;power&#39;</span></span>
<span id="cb20-7"><a href="one-sample-proportion-power-based-sample-size.html#cb20-7" tabindex="-1"></a>pw_settings <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">delta=</span>d0, </span>
<span id="cb20-8"><a href="one-sample-proportion-power-based-sample-size.html#cb20-8" tabindex="-1"></a>                           <span class="at">p0=</span>p0, </span>
<span id="cb20-9"><a href="one-sample-proportion-power-based-sample-size.html#cb20-9" tabindex="-1"></a>                           <span class="at">power =</span> pw0, </span>
<span id="cb20-10"><a href="one-sample-proportion-power-based-sample-size.html#cb20-10" tabindex="-1"></a>                           <span class="at">method =</span> m0,</span>
<span id="cb20-11"><a href="one-sample-proportion-power-based-sample-size.html#cb20-11" tabindex="-1"></a>                           <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-12"><a href="one-sample-proportion-power-based-sample-size.html#cb20-12" tabindex="-1"></a>pw_settings<span class="sc">$</span>p <span class="ot">&lt;-</span> pw_settings<span class="sc">$</span>p0 <span class="sc">+</span> pw_settings<span class="sc">$</span>delta</span>
<span id="cb20-13"><a href="one-sample-proportion-power-based-sample-size.html#cb20-13" tabindex="-1"></a></span>
<span id="cb20-14"><a href="one-sample-proportion-power-based-sample-size.html#cb20-14" tabindex="-1"></a><span class="co"># Calculate &#39;n&#39; for each combination</span></span>
<span id="cb20-15"><a href="one-sample-proportion-power-based-sample-size.html#cb20-15" tabindex="-1"></a>pw_settings<span class="sc">$</span>n <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pw_settings), </span>
<span id="cb20-16"><a href="one-sample-proportion-power-based-sample-size.html#cb20-16" tabindex="-1"></a>  <span class="cf">function</span>(idx) </span>
<span id="cb20-17"><a href="one-sample-proportion-power-based-sample-size.html#cb20-17" tabindex="-1"></a>    <span class="fu">with</span>(pw_settings,</span>
<span id="cb20-18"><a href="one-sample-proportion-power-based-sample-size.html#cb20-18" tabindex="-1"></a>         {<span class="cf">if</span>(p[idx] <span class="sc">==</span> p0[idx]) <span class="cn">Inf</span> <span class="cf">else</span>  </span>
<span id="cb20-19"><a href="one-sample-proportion-power-based-sample-size.html#cb20-19" tabindex="-1"></a>          <span class="fu">power_one_prop_test</span>(<span class="at">p=</span>p[idx], <span class="at">p0=</span>p0[idx], <span class="at">power=</span>power[idx],</span>
<span id="cb20-20"><a href="one-sample-proportion-power-based-sample-size.html#cb20-20" tabindex="-1"></a>                          <span class="at">test=</span>method[idx])<span class="sc">$</span>n}))</span>
<span id="cb20-21"><a href="one-sample-proportion-power-based-sample-size.html#cb20-21" tabindex="-1"></a></span>
<span id="cb20-22"><a href="one-sample-proportion-power-based-sample-size.html#cb20-22" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb20-23"><a href="one-sample-proportion-power-based-sample-size.html#cb20-23" tabindex="-1"></a><span class="fu">ggplot</span>(pw_settings,</span>
<span id="cb20-24"><a href="one-sample-proportion-power-based-sample-size.html#cb20-24" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> delta, <span class="at">y =</span> n, <span class="at">color =</span> <span class="fu">factor</span>(p0), <span class="at">linetype =</span> method)) <span class="sc">+</span></span>
<span id="cb20-25"><a href="one-sample-proportion-power-based-sample-size.html#cb20-25" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> power) <span class="sc">+</span></span>
<span id="cb20-26"><a href="one-sample-proportion-power-based-sample-size.html#cb20-26" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb20-27"><a href="one-sample-proportion-power-based-sample-size.html#cb20-27" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb20-28"><a href="one-sample-proportion-power-based-sample-size.html#cb20-28" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">&quot;p0&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-29"><a href="one-sample-proportion-power-based-sample-size.html#cb20-29" tabindex="-1"></a>  <span class="fu">scale_linetype_discrete</span>(<span class="st">&quot;Method&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-30"><a href="one-sample-proportion-power-based-sample-size.html#cb20-30" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Change in event probability &#39;p&#39; - &#39;p0&#39;&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-31"><a href="one-sample-proportion-power-based-sample-size.html#cb20-31" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Sample size &#39;n&#39;&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-32"><a href="one-sample-proportion-power-based-sample-size.html#cb20-32" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Sample size required to achieve target power&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-33"><a href="one-sample-proportion-power-based-sample-size.html#cb20-33" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb20-34"><a href="one-sample-proportion-power-based-sample-size.html#cb20-34" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="B_02_one_prop_power_files/figure-html/OneProp_PowerPlot-1.png" width="672" /></p>
<p>The following conclusions can be made based on the plots:</p>
<ul>
<li><p>The sample size depends on the direction of the difference:</p>
<ul>
<li>For <span class="math inline">\(p_0=0.5\)</span> the direction does not matter</li>
<li>For <span class="math inline">\(p_0&lt;0.5\)</span>, fewer samples are needed if <span class="math inline">\(p &lt; p_0\)</span>, while for <span class="math inline">\(p_0&gt;0.5\)</span> the effect is opposite.</li>
<li>If the sign of the difference is flipped, then the required sample size is the same if we also change <span class="math inline">\(p_0\)</span> to <span class="math inline">\(1-p_0\)</span>. For example, detecting a 10% decrease from 20% (to 10%) requires the same sample size as detecting a 10% increase from 80% (to 90%).</li>
</ul></li>
<li><p>Higher power will require larger sample size (as always), but its effect is smaller than that of the <span class="math inline">\(p-p_0\)</span> difference</p></li>
<li><p>The three methods require similar samples size in general, especially the binomial and score tests, with a few notable exceptions:</p>
<ul>
<li>The Wald test requires fewer samples compared to the other methods when <span class="math inline">\(p &lt; p_0 &lt; 0.5\)</span>, or symmetrically, <span class="math inline">\(p &gt; p_0 &gt; 0.5\)</span></li>
<li>There is a smaller opposite effect when <span class="math inline">\(p_0 &lt; p &lt; 0.5\)</span> (or <span class="math inline">\(p_0 &gt; p &gt; 0.5\)</span>), with the Wald test requiring the most samples, and the score test the least.</li>
</ul></li>
</ul>
<p>Most of these observations can be explained by the fact that the <span class="math inline">\(p(1-p)\)</span> terms showing up in the power formulas have a maximum at <span class="math inline">\(p=0.5\)</span>.</p>
</div>
<div id="simulation-studies" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Simulation studies<a href="one-sample-proportion-power-based-sample-size.html#simulation-studies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First, we define functions that simulate data according to the data generating mechanism, and then apply the tests to each replicate.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="one-sample-proportion-power-based-sample-size.html#cb21-1" tabindex="-1"></a><span class="co">#&#39; Simulate binomial data </span></span>
<span id="cb21-2"><a href="one-sample-proportion-power-based-sample-size.html#cb21-2" tabindex="-1"></a><span class="co">#&#39; @param p event probability</span></span>
<span id="cb21-3"><a href="one-sample-proportion-power-based-sample-size.html#cb21-3" tabindex="-1"></a><span class="co">#&#39; @param n sample size</span></span>
<span id="cb21-4"><a href="one-sample-proportion-power-based-sample-size.html#cb21-4" tabindex="-1"></a><span class="co">#&#39; @param R number of simulations</span></span>
<span id="cb21-5"><a href="one-sample-proportion-power-based-sample-size.html#cb21-5" tabindex="-1"></a><span class="co">#&#39; @returns data frame with R rows with the simulation ID, the simulated number of successes,</span></span>
<span id="cb21-6"><a href="one-sample-proportion-power-based-sample-size.html#cb21-6" tabindex="-1"></a><span class="co">#&#39; &#39;x&#39;, and the sample size &#39;n&#39;</span></span>
<span id="cb21-7"><a href="one-sample-proportion-power-based-sample-size.html#cb21-7" tabindex="-1"></a>sim_one_prop <span class="ot">&lt;-</span> <span class="cf">function</span>(p, n, <span class="at">R=</span><span class="dv">1</span>){</span>
<span id="cb21-8"><a href="one-sample-proportion-power-based-sample-size.html#cb21-8" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span>R, </span>
<span id="cb21-9"><a href="one-sample-proportion-power-based-sample-size.html#cb21-9" tabindex="-1"></a>             <span class="at">x =</span> <span class="fu">rbinom</span>(R, <span class="at">size=</span>n, <span class="at">prob=</span>p), </span>
<span id="cb21-10"><a href="one-sample-proportion-power-based-sample-size.html#cb21-10" tabindex="-1"></a>             <span class="at">n=</span>n)</span>
<span id="cb21-11"><a href="one-sample-proportion-power-based-sample-size.html#cb21-11" tabindex="-1"></a>}</span>
<span id="cb21-12"><a href="one-sample-proportion-power-based-sample-size.html#cb21-12" tabindex="-1"></a></span>
<span id="cb21-13"><a href="one-sample-proportion-power-based-sample-size.html#cb21-13" tabindex="-1"></a><span class="co">#&#39; Analyze simulated binomial data </span></span>
<span id="cb21-14"><a href="one-sample-proportion-power-based-sample-size.html#cb21-14" tabindex="-1"></a><span class="co">#&#39; @param simdat output of `sim_one_prop`</span></span>
<span id="cb21-15"><a href="one-sample-proportion-power-based-sample-size.html#cb21-15" tabindex="-1"></a><span class="co">#&#39; @param p0 the null hypothesis value for the test</span></span>
<span id="cb21-16"><a href="one-sample-proportion-power-based-sample-size.html#cb21-16" tabindex="-1"></a><span class="co">#&#39; @param ... additional arguments passed to `one_prop_test`</span></span>
<span id="cb21-17"><a href="one-sample-proportion-power-based-sample-size.html#cb21-17" tabindex="-1"></a><span class="co">#&#39; @returns data frame with estimate, statistic, and p-value from test for each simulation ID</span></span>
<span id="cb21-18"><a href="one-sample-proportion-power-based-sample-size.html#cb21-18" tabindex="-1"></a>analyze_one_prop <span class="ot">&lt;-</span> <span class="cf">function</span>(simdat, p0, ...){</span>
<span id="cb21-19"><a href="one-sample-proportion-power-based-sample-size.html#cb21-19" tabindex="-1"></a>  <span class="co"># run test on each row</span></span>
<span id="cb21-20"><a href="one-sample-proportion-power-based-sample-size.html#cb21-20" tabindex="-1"></a>  tst_list <span class="ot">&lt;-</span> <span class="fu">mapply</span>(one_prop_test, <span class="at">x=</span>simdat<span class="sc">$</span>x, <span class="at">n=</span>simdat<span class="sc">$</span>n, </span>
<span id="cb21-21"><a href="one-sample-proportion-power-based-sample-size.html#cb21-21" tabindex="-1"></a>                     <span class="at">MoreArgs=</span><span class="fu">list</span>(<span class="at">p0 =</span> p0, ...), <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-22"><a href="one-sample-proportion-power-based-sample-size.html#cb21-22" tabindex="-1"></a>  <span class="fu">names</span>(tst_list) <span class="ot">&lt;-</span> simdat<span class="sc">$</span>ID</span>
<span id="cb21-23"><a href="one-sample-proportion-power-based-sample-size.html#cb21-23" tabindex="-1"></a>  <span class="co"># extract values of interest </span></span>
<span id="cb21-24"><a href="one-sample-proportion-power-based-sample-size.html#cb21-24" tabindex="-1"></a>  res_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tst_list, </span>
<span id="cb21-25"><a href="one-sample-proportion-power-based-sample-size.html#cb21-25" tabindex="-1"></a>                     <span class="cf">function</span>(tst)<span class="fu">c</span>(tst<span class="sc">$</span>estimate, tst<span class="sc">$</span>statistic, tst<span class="sc">$</span>p.value))</span>
<span id="cb21-26"><a href="one-sample-proportion-power-based-sample-size.html#cb21-26" tabindex="-1"></a>  <span class="co"># combine results into one data set</span></span>
<span id="cb21-27"><a href="one-sample-proportion-power-based-sample-size.html#cb21-27" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">do.call</span>(rbind, res_list))</span>
<span id="cb21-28"><a href="one-sample-proportion-power-based-sample-size.html#cb21-28" tabindex="-1"></a>  <span class="fu">names</span>(res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;estimate&quot;</span>, <span class="st">&quot;statistic&quot;</span>, <span class="st">&quot;p.value&quot;</span>)</span>
<span id="cb21-29"><a href="one-sample-proportion-power-based-sample-size.html#cb21-29" tabindex="-1"></a>  res<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">rownames</span>(res)</span>
<span id="cb21-30"><a href="one-sample-proportion-power-based-sample-size.html#cb21-30" tabindex="-1"></a>  res</span>
<span id="cb21-31"><a href="one-sample-proportion-power-based-sample-size.html#cb21-31" tabindex="-1"></a>}</span></code></pre></div>
<div id="achieved-power-when-calculating-sample-size" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Achieved power when calculating sample size<a href="one-sample-proportion-power-based-sample-size.html#achieved-power-when-calculating-sample-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first simulation study explores how the achieved power lines up with the design power using the sample size calculations.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="one-sample-proportion-power-based-sample-size.html#cb22-1" tabindex="-1"></a><span class="co"># create simulation settings based on p-p0 difference </span></span>
<span id="cb22-2"><a href="one-sample-proportion-power-based-sample-size.html#cb22-2" tabindex="-1"></a>sim_settings <span class="ot">&lt;-</span> </span>
<span id="cb22-3"><a href="one-sample-proportion-power-based-sample-size.html#cb22-3" tabindex="-1"></a>  <span class="fu">expand.grid</span>(<span class="at">p0 =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>),</span>
<span id="cb22-4"><a href="one-sample-proportion-power-based-sample-size.html#cb22-4" tabindex="-1"></a>              <span class="at">method =</span> m0, </span>
<span id="cb22-5"><a href="one-sample-proportion-power-based-sample-size.html#cb22-5" tabindex="-1"></a>              <span class="at">power =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>),</span>
<span id="cb22-6"><a href="one-sample-proportion-power-based-sample-size.html#cb22-6" tabindex="-1"></a>              <span class="at">delta =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>),</span>
<span id="cb22-7"><a href="one-sample-proportion-power-based-sample-size.html#cb22-7" tabindex="-1"></a>              <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-8"><a href="one-sample-proportion-power-based-sample-size.html#cb22-8" tabindex="-1"></a>sim_settings<span class="sc">$</span>p <span class="ot">&lt;-</span> sim_settings<span class="sc">$</span>p0 <span class="sc">+</span> sim_settings<span class="sc">$</span>delta</span>
<span id="cb22-9"><a href="one-sample-proportion-power-based-sample-size.html#cb22-9" tabindex="-1"></a></span>
<span id="cb22-10"><a href="one-sample-proportion-power-based-sample-size.html#cb22-10" tabindex="-1"></a><span class="co">#&#39; Function to run simulations for study 1: given power target, calculate sample size and check achieved power</span></span>
<span id="cb22-11"><a href="one-sample-proportion-power-based-sample-size.html#cb22-11" tabindex="-1"></a><span class="co">#&#39; @param simset data set with simulation settings - one column per parameter</span></span>
<span id="cb22-12"><a href="one-sample-proportion-power-based-sample-size.html#cb22-12" tabindex="-1"></a><span class="co">#&#39; @param R number of replicates per setting</span></span>
<span id="cb22-13"><a href="one-sample-proportion-power-based-sample-size.html#cb22-13" tabindex="-1"></a><span class="co">#&#39; @param ... additional arguments to &#39;power_one_prop_test&#39; not defined in &#39;simset&#39;</span></span>
<span id="cb22-14"><a href="one-sample-proportion-power-based-sample-size.html#cb22-14" tabindex="-1"></a><span class="co">#&#39; @returns data frame with one row per each simulation replicate</span></span>
<span id="cb22-15"><a href="one-sample-proportion-power-based-sample-size.html#cb22-15" tabindex="-1"></a>run_one_prop_sim1 <span class="ot">&lt;-</span> <span class="cf">function</span>(simset, R, ...){</span>
<span id="cb22-16"><a href="one-sample-proportion-power-based-sample-size.html#cb22-16" tabindex="-1"></a>  sim_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb22-17"><a href="one-sample-proportion-power-based-sample-size.html#cb22-17" tabindex="-1"></a>  <span class="co"># loop through simulation settings</span></span>
<span id="cb22-18"><a href="one-sample-proportion-power-based-sample-size.html#cb22-18" tabindex="-1"></a>  <span class="cf">for</span> (idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(simset)){</span>
<span id="cb22-19"><a href="one-sample-proportion-power-based-sample-size.html#cb22-19" tabindex="-1"></a>    simres <span class="ot">&lt;-</span> <span class="fu">with</span>(simset[idx,], {</span>
<span id="cb22-20"><a href="one-sample-proportion-power-based-sample-size.html#cb22-20" tabindex="-1"></a>      <span class="co"># calculate &#39;n&#39;</span></span>
<span id="cb22-21"><a href="one-sample-proportion-power-based-sample-size.html#cb22-21" tabindex="-1"></a>      pw <span class="ot">&lt;-</span> <span class="fu">power_one_prop_test</span>(<span class="at">n=</span><span class="cn">NULL</span>, <span class="at">p =</span> p, <span class="at">p0 =</span> p0, <span class="at">test =</span> method, </span>
<span id="cb22-22"><a href="one-sample-proportion-power-based-sample-size.html#cb22-22" tabindex="-1"></a>                               <span class="at">power=</span>power, ... )</span>
<span id="cb22-23"><a href="one-sample-proportion-power-based-sample-size.html#cb22-23" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(pw<span class="sc">$</span>n)</span>
<span id="cb22-24"><a href="one-sample-proportion-power-based-sample-size.html#cb22-24" tabindex="-1"></a>      <span class="co"># simulate R replicates</span></span>
<span id="cb22-25"><a href="one-sample-proportion-power-based-sample-size.html#cb22-25" tabindex="-1"></a>      simdat <span class="ot">&lt;-</span> <span class="fu">sim_one_prop</span>(<span class="at">p =</span> p, <span class="at">n =</span> n, <span class="at">R =</span> R)</span>
<span id="cb22-26"><a href="one-sample-proportion-power-based-sample-size.html#cb22-26" tabindex="-1"></a>      <span class="co"># analyze the data and return as simres</span></span>
<span id="cb22-27"><a href="one-sample-proportion-power-based-sample-size.html#cb22-27" tabindex="-1"></a>      tmp <span class="ot">&lt;-</span> <span class="fu">analyze_one_prop</span>(simdat, <span class="at">p0 =</span> p0, <span class="at">method =</span> method, ...)</span>
<span id="cb22-28"><a href="one-sample-proportion-power-based-sample-size.html#cb22-28" tabindex="-1"></a>      <span class="co"># add &#39;n&#39;</span></span>
<span id="cb22-29"><a href="one-sample-proportion-power-based-sample-size.html#cb22-29" tabindex="-1"></a>      <span class="fu">cbind</span>(tmp, <span class="at">n=</span>n)</span>
<span id="cb22-30"><a href="one-sample-proportion-power-based-sample-size.html#cb22-30" tabindex="-1"></a>    })</span>
<span id="cb22-31"><a href="one-sample-proportion-power-based-sample-size.html#cb22-31" tabindex="-1"></a>    <span class="co"># append simulation settings</span></span>
<span id="cb22-32"><a href="one-sample-proportion-power-based-sample-size.html#cb22-32" tabindex="-1"></a>    simres <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">simID =</span> idx, simres, simset[idx,])</span>
<span id="cb22-33"><a href="one-sample-proportion-power-based-sample-size.html#cb22-33" tabindex="-1"></a>    <span class="co"># save result</span></span>
<span id="cb22-34"><a href="one-sample-proportion-power-based-sample-size.html#cb22-34" tabindex="-1"></a>    sim_list <span class="ot">&lt;-</span> <span class="fu">c</span>(sim_list, <span class="fu">list</span>(simres))</span>
<span id="cb22-35"><a href="one-sample-proportion-power-based-sample-size.html#cb22-35" tabindex="-1"></a>  }</span>
<span id="cb22-36"><a href="one-sample-proportion-power-based-sample-size.html#cb22-36" tabindex="-1"></a>  <span class="co"># combine data</span></span>
<span id="cb22-37"><a href="one-sample-proportion-power-based-sample-size.html#cb22-37" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, sim_list)</span>
<span id="cb22-38"><a href="one-sample-proportion-power-based-sample-size.html#cb22-38" tabindex="-1"></a>  res</span>
<span id="cb22-39"><a href="one-sample-proportion-power-based-sample-size.html#cb22-39" tabindex="-1"></a>}</span>
<span id="cb22-40"><a href="one-sample-proportion-power-based-sample-size.html#cb22-40" tabindex="-1"></a></span>
<span id="cb22-41"><a href="one-sample-proportion-power-based-sample-size.html#cb22-41" tabindex="-1"></a><span class="co"># run simulations</span></span>
<span id="cb22-42"><a href="one-sample-proportion-power-based-sample-size.html#cb22-42" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">45636</span>)</span>
<span id="cb22-43"><a href="one-sample-proportion-power-based-sample-size.html#cb22-43" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb22-44"><a href="one-sample-proportion-power-based-sample-size.html#cb22-44" tabindex="-1"></a>sim1 <span class="ot">&lt;-</span> <span class="fu">run_one_prop_sim1</span>(sim_settings, <span class="at">R=</span>R)</span>
<span id="cb22-45"><a href="one-sample-proportion-power-based-sample-size.html#cb22-45" tabindex="-1"></a><span class="co"># extract power at alpha=0.05</span></span>
<span id="cb22-46"><a href="one-sample-proportion-power-based-sample-size.html#cb22-46" tabindex="-1"></a>sim1_pw <span class="ot">&lt;-</span>  <span class="fu">aggregate</span>(p.value <span class="sc">~</span> p<span class="sc">+</span>delta<span class="sc">+</span>p0<span class="sc">+</span>method<span class="sc">+</span>power, </span>
<span id="cb22-47"><a href="one-sample-proportion-power-based-sample-size.html#cb22-47" tabindex="-1"></a>                      <span class="at">data=</span>sim1, </span>
<span id="cb22-48"><a href="one-sample-proportion-power-based-sample-size.html#cb22-48" tabindex="-1"></a>                      <span class="at">FUN =</span> <span class="cf">function</span>(x)<span class="fu">mean</span>(x <span class="sc">&lt;=</span> <span class="fl">0.05</span>))</span>
<span id="cb22-49"><a href="one-sample-proportion-power-based-sample-size.html#cb22-49" tabindex="-1"></a><span class="co"># rename &#39;p.value&#39; column to better describe its current contents</span></span>
<span id="cb22-50"><a href="one-sample-proportion-power-based-sample-size.html#cb22-50" tabindex="-1"></a><span class="fu">names</span>(sim1_pw)[<span class="fu">names</span>(sim1_pw) <span class="sc">==</span><span class="st">&quot;p.value&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;est.power&quot;</span></span>
<span id="cb22-51"><a href="one-sample-proportion-power-based-sample-size.html#cb22-51" tabindex="-1"></a><span class="co"># standard error </span></span>
<span id="cb22-52"><a href="one-sample-proportion-power-based-sample-size.html#cb22-52" tabindex="-1"></a>sim1_pw <span class="ot">&lt;-</span> <span class="fu">transform</span>(sim1_pw,</span>
<span id="cb22-53"><a href="one-sample-proportion-power-based-sample-size.html#cb22-53" tabindex="-1"></a>                     <span class="at">est.power.se =</span> <span class="fu">sqrt</span>(est.power<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>est.power)<span class="sc">/</span>R))</span>
<span id="cb22-54"><a href="one-sample-proportion-power-based-sample-size.html#cb22-54" tabindex="-1"></a></span>
<span id="cb22-55"><a href="one-sample-proportion-power-based-sample-size.html#cb22-55" tabindex="-1"></a><span class="co"># create plot</span></span>
<span id="cb22-56"><a href="one-sample-proportion-power-based-sample-size.html#cb22-56" tabindex="-1"></a><span class="fu">ggplot</span>(sim1_pw, <span class="fu">aes</span>(<span class="at">x=</span>p, <span class="at">y=</span>est.power, <span class="at">color =</span> <span class="fu">factor</span>(power))) <span class="sc">+</span></span>
<span id="cb22-57"><a href="one-sample-proportion-power-based-sample-size.html#cb22-57" tabindex="-1"></a>  <span class="fu">facet_grid</span>(method <span class="sc">~</span> p0, <span class="at">labeller =</span> label_both, <span class="at">scales=</span><span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-58"><a href="one-sample-proportion-power-based-sample-size.html#cb22-58" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> power, <span class="at">color =</span> <span class="fu">factor</span>(power))) <span class="sc">+</span></span>
<span id="cb22-59"><a href="one-sample-proportion-power-based-sample-size.html#cb22-59" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> est.power<span class="sc">-</span>est.power.se, <span class="at">ymax =</span> est.power<span class="sc">+</span>est.power.se)) <span class="sc">+</span></span>
<span id="cb22-60"><a href="one-sample-proportion-power-based-sample-size.html#cb22-60" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;True event probability &#39;p&#39;&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-61"><a href="one-sample-proportion-power-based-sample-size.html#cb22-61" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Estimated power (+- SE)&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-62"><a href="one-sample-proportion-power-based-sample-size.html#cb22-62" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">&quot;Power&quot;</span>)</span></code></pre></div>
<p><img src="B_02_one_prop_power_files/figure-html/OnePropSim1-1.png" width="672" /></p>
<p>We can see that in most situations, the simulated power (dots) is close to the target value (horizontal line)-</p>
</div>
<div id="achieved-power-with-fixed-sample-size" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Achieved power with fixed sample size<a href="one-sample-proportion-power-based-sample-size.html#achieved-power-with-fixed-sample-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The second simulation study explores how the achieved power lines up with the calculated power when using a fixed sample size.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="one-sample-proportion-power-based-sample-size.html#cb23-1" tabindex="-1"></a><span class="co"># create simulation settings based on p-p0 difference </span></span>
<span id="cb23-2"><a href="one-sample-proportion-power-based-sample-size.html#cb23-2" tabindex="-1"></a>sim_settings2 <span class="ot">&lt;-</span> </span>
<span id="cb23-3"><a href="one-sample-proportion-power-based-sample-size.html#cb23-3" tabindex="-1"></a>  <span class="fu">expand.grid</span>(<span class="at">p0 =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>),</span>
<span id="cb23-4"><a href="one-sample-proportion-power-based-sample-size.html#cb23-4" tabindex="-1"></a>              <span class="at">method =</span> m0, </span>
<span id="cb23-5"><a href="one-sample-proportion-power-based-sample-size.html#cb23-5" tabindex="-1"></a>              <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb23-6"><a href="one-sample-proportion-power-based-sample-size.html#cb23-6" tabindex="-1"></a>              <span class="at">delta =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.15</span>, <span class="sc">-</span><span class="fl">0.1</span>, <span class="sc">-</span><span class="fl">0.05</span>, <span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>),</span>
<span id="cb23-7"><a href="one-sample-proportion-power-based-sample-size.html#cb23-7" tabindex="-1"></a>              <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb23-8"><a href="one-sample-proportion-power-based-sample-size.html#cb23-8" tabindex="-1"></a>sim_settings2<span class="sc">$</span>p <span class="ot">&lt;-</span> sim_settings2<span class="sc">$</span>p0 <span class="sc">+</span> sim_settings2<span class="sc">$</span>delta</span>
<span id="cb23-9"><a href="one-sample-proportion-power-based-sample-size.html#cb23-9" tabindex="-1"></a></span>
<span id="cb23-10"><a href="one-sample-proportion-power-based-sample-size.html#cb23-10" tabindex="-1"></a><span class="co">#&#39; Function to run simulations for study 2: given sample size, calculate power and check achieved power</span></span>
<span id="cb23-11"><a href="one-sample-proportion-power-based-sample-size.html#cb23-11" tabindex="-1"></a><span class="co">#&#39; @param simset data set with simulation settings - one column per parameter</span></span>
<span id="cb23-12"><a href="one-sample-proportion-power-based-sample-size.html#cb23-12" tabindex="-1"></a><span class="co">#&#39; @param R number of replicates per setting</span></span>
<span id="cb23-13"><a href="one-sample-proportion-power-based-sample-size.html#cb23-13" tabindex="-1"></a><span class="co">#&#39; @param ... additional arguments to &#39;power_one_prop_test&#39; not defined in &#39;simset&#39;</span></span>
<span id="cb23-14"><a href="one-sample-proportion-power-based-sample-size.html#cb23-14" tabindex="-1"></a><span class="co">#&#39; @returns data frame with one row per each simulation replicate</span></span>
<span id="cb23-15"><a href="one-sample-proportion-power-based-sample-size.html#cb23-15" tabindex="-1"></a>run_one_prop_sim2 <span class="ot">&lt;-</span> <span class="cf">function</span>(simset, R, ...){</span>
<span id="cb23-16"><a href="one-sample-proportion-power-based-sample-size.html#cb23-16" tabindex="-1"></a>  sim_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-17"><a href="one-sample-proportion-power-based-sample-size.html#cb23-17" tabindex="-1"></a>  <span class="co"># loop through simulation settings</span></span>
<span id="cb23-18"><a href="one-sample-proportion-power-based-sample-size.html#cb23-18" tabindex="-1"></a>  <span class="cf">for</span> (idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(simset)){</span>
<span id="cb23-19"><a href="one-sample-proportion-power-based-sample-size.html#cb23-19" tabindex="-1"></a>    simres <span class="ot">&lt;-</span> <span class="fu">with</span>(simset[idx,], {</span>
<span id="cb23-20"><a href="one-sample-proportion-power-based-sample-size.html#cb23-20" tabindex="-1"></a>      <span class="co"># calculate &#39;power&#39;</span></span>
<span id="cb23-21"><a href="one-sample-proportion-power-based-sample-size.html#cb23-21" tabindex="-1"></a>      pw <span class="ot">&lt;-</span> <span class="fu">power_one_prop_test</span>(<span class="at">n=</span>n, <span class="at">p =</span> p, <span class="at">p0 =</span> p0, <span class="at">test =</span> method, </span>
<span id="cb23-22"><a href="one-sample-proportion-power-based-sample-size.html#cb23-22" tabindex="-1"></a>                               <span class="at">power=</span><span class="cn">NULL</span>, ... )</span>
<span id="cb23-23"><a href="one-sample-proportion-power-based-sample-size.html#cb23-23" tabindex="-1"></a>      <span class="co"># simulate R replicates</span></span>
<span id="cb23-24"><a href="one-sample-proportion-power-based-sample-size.html#cb23-24" tabindex="-1"></a>      simdat <span class="ot">&lt;-</span> <span class="fu">sim_one_prop</span>(<span class="at">p =</span> p, <span class="at">n =</span> n, <span class="at">R =</span> R)</span>
<span id="cb23-25"><a href="one-sample-proportion-power-based-sample-size.html#cb23-25" tabindex="-1"></a>      <span class="co"># analyze the data and return as simres</span></span>
<span id="cb23-26"><a href="one-sample-proportion-power-based-sample-size.html#cb23-26" tabindex="-1"></a>      tmp <span class="ot">&lt;-</span> <span class="fu">analyze_one_prop</span>(simdat, <span class="at">p0 =</span> p0, <span class="at">method =</span> method, ...)</span>
<span id="cb23-27"><a href="one-sample-proportion-power-based-sample-size.html#cb23-27" tabindex="-1"></a>      <span class="co"># add &#39;power&#39;</span></span>
<span id="cb23-28"><a href="one-sample-proportion-power-based-sample-size.html#cb23-28" tabindex="-1"></a>      <span class="fu">cbind</span>(tmp, <span class="at">power=</span>pw<span class="sc">$</span>power)</span>
<span id="cb23-29"><a href="one-sample-proportion-power-based-sample-size.html#cb23-29" tabindex="-1"></a>    })</span>
<span id="cb23-30"><a href="one-sample-proportion-power-based-sample-size.html#cb23-30" tabindex="-1"></a>    <span class="co"># append simulation settings</span></span>
<span id="cb23-31"><a href="one-sample-proportion-power-based-sample-size.html#cb23-31" tabindex="-1"></a>    simres <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">simID =</span> idx, simres, simset[idx,])</span>
<span id="cb23-32"><a href="one-sample-proportion-power-based-sample-size.html#cb23-32" tabindex="-1"></a>    <span class="co"># save result</span></span>
<span id="cb23-33"><a href="one-sample-proportion-power-based-sample-size.html#cb23-33" tabindex="-1"></a>    sim_list <span class="ot">&lt;-</span> <span class="fu">c</span>(sim_list, <span class="fu">list</span>(simres))</span>
<span id="cb23-34"><a href="one-sample-proportion-power-based-sample-size.html#cb23-34" tabindex="-1"></a>  }</span>
<span id="cb23-35"><a href="one-sample-proportion-power-based-sample-size.html#cb23-35" tabindex="-1"></a>  <span class="co"># combine data</span></span>
<span id="cb23-36"><a href="one-sample-proportion-power-based-sample-size.html#cb23-36" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, sim_list)</span>
<span id="cb23-37"><a href="one-sample-proportion-power-based-sample-size.html#cb23-37" tabindex="-1"></a>  res</span>
<span id="cb23-38"><a href="one-sample-proportion-power-based-sample-size.html#cb23-38" tabindex="-1"></a>}</span>
<span id="cb23-39"><a href="one-sample-proportion-power-based-sample-size.html#cb23-39" tabindex="-1"></a></span>
<span id="cb23-40"><a href="one-sample-proportion-power-based-sample-size.html#cb23-40" tabindex="-1"></a><span class="co"># run simulations</span></span>
<span id="cb23-41"><a href="one-sample-proportion-power-based-sample-size.html#cb23-41" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">45636</span>)</span>
<span id="cb23-42"><a href="one-sample-proportion-power-based-sample-size.html#cb23-42" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb23-43"><a href="one-sample-proportion-power-based-sample-size.html#cb23-43" tabindex="-1"></a>sim2 <span class="ot">&lt;-</span> <span class="fu">run_one_prop_sim2</span>(sim_settings2, <span class="at">R=</span>R)</span>
<span id="cb23-44"><a href="one-sample-proportion-power-based-sample-size.html#cb23-44" tabindex="-1"></a><span class="co"># extract power at alpha=0.05</span></span>
<span id="cb23-45"><a href="one-sample-proportion-power-based-sample-size.html#cb23-45" tabindex="-1"></a>sim2_pw <span class="ot">&lt;-</span>  <span class="fu">aggregate</span>(p.value <span class="sc">~</span> p<span class="sc">+</span>delta<span class="sc">+</span>p0<span class="sc">+</span>method<span class="sc">+</span>n<span class="sc">+</span>power, </span>
<span id="cb23-46"><a href="one-sample-proportion-power-based-sample-size.html#cb23-46" tabindex="-1"></a>                      <span class="at">data=</span>sim2, </span>
<span id="cb23-47"><a href="one-sample-proportion-power-based-sample-size.html#cb23-47" tabindex="-1"></a>                      <span class="at">FUN =</span> <span class="cf">function</span>(x)<span class="fu">mean</span>(x <span class="sc">&lt;=</span> <span class="fl">0.05</span>))</span>
<span id="cb23-48"><a href="one-sample-proportion-power-based-sample-size.html#cb23-48" tabindex="-1"></a><span class="co"># rename &#39;p.value&#39; column to better describe its current contents</span></span>
<span id="cb23-49"><a href="one-sample-proportion-power-based-sample-size.html#cb23-49" tabindex="-1"></a><span class="fu">names</span>(sim2_pw)[<span class="fu">names</span>(sim2_pw) <span class="sc">==</span><span class="st">&quot;p.value&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;est.power&quot;</span></span>
<span id="cb23-50"><a href="one-sample-proportion-power-based-sample-size.html#cb23-50" tabindex="-1"></a><span class="co"># standard error </span></span>
<span id="cb23-51"><a href="one-sample-proportion-power-based-sample-size.html#cb23-51" tabindex="-1"></a>sim2_pw <span class="ot">&lt;-</span> <span class="fu">transform</span>(sim2_pw,</span>
<span id="cb23-52"><a href="one-sample-proportion-power-based-sample-size.html#cb23-52" tabindex="-1"></a>                     <span class="at">est.power.se =</span> <span class="fu">sqrt</span>(est.power<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>est.power)<span class="sc">/</span>R))</span>
<span id="cb23-53"><a href="one-sample-proportion-power-based-sample-size.html#cb23-53" tabindex="-1"></a></span>
<span id="cb23-54"><a href="one-sample-proportion-power-based-sample-size.html#cb23-54" tabindex="-1"></a><span class="co"># create plot</span></span>
<span id="cb23-55"><a href="one-sample-proportion-power-based-sample-size.html#cb23-55" tabindex="-1"></a><span class="fu">ggplot</span>(sim2_pw, <span class="fu">aes</span>(<span class="at">x=</span>p, <span class="at">y=</span>est.power, <span class="at">color=</span><span class="fu">factor</span>(n))) <span class="sc">+</span></span>
<span id="cb23-56"><a href="one-sample-proportion-power-based-sample-size.html#cb23-56" tabindex="-1"></a>  <span class="fu">facet_grid</span>(method <span class="sc">~</span> p0, <span class="at">labeller =</span> label_both, <span class="at">scales=</span><span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-57"><a href="one-sample-proportion-power-based-sample-size.html#cb23-57" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> power, <span class="at">color=</span><span class="fu">factor</span>(n))) <span class="sc">+</span></span>
<span id="cb23-58"><a href="one-sample-proportion-power-based-sample-size.html#cb23-58" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> est.power<span class="sc">-</span>est.power.se, <span class="at">ymax =</span> est.power<span class="sc">+</span>est.power.se)) <span class="sc">+</span></span>
<span id="cb23-59"><a href="one-sample-proportion-power-based-sample-size.html#cb23-59" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;True event probability &#39;p&#39;&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-60"><a href="one-sample-proportion-power-based-sample-size.html#cb23-60" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Estimated power (+- SE)&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-61"><a href="one-sample-proportion-power-based-sample-size.html#cb23-61" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">&quot;Sample size &#39;n&#39;&quot;</span>)</span></code></pre></div>
<p><img src="B_02_one_prop_power_files/figure-html/OnePropSim2-1.png" width="672" /></p>
</div>
</div>
<div id="example-revisited-2" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Example revisited<a href="one-sample-proportion-power-based-sample-size.html#example-revisited-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="functions-in-r-packages-2" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Functions in R packages<a href="one-sample-proportion-power-based-sample-size.html#functions-in-r-packages-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="refs" class="references csl-bib-body">
<div class="csl-entry">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Dorai-Raj S. <em>Binom: Binomial Confidence Intervals for Several Parameterizations</em>.; 2022. <a href="https://CRAN.R-project.org/package=binom">https://CRAN.R-project.org/package=binom</a></div>
</div>
<div class="csl-entry">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Lenz A, Haynes AG, Limacher A. <em>Presize: Precision Based Sample Size Calculation</em>.; 2022. <a href="https://CRAN.R-project.org/package=presize">https://CRAN.R-project.org/package=presize</a></div>
</div>
<div class="csl-entry">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Haynes AG, Lenz A, Stalder O, Limacher A. Presize: An <span>R</span>-package for precision-based sample size calculation in clinical research. <em>Journal of Open Source Software</em>. 2021;6(60):3118. doi:<a href="https://doi.org/10.21105/joss.03118">10.21105/joss.03118</a></div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="one-sample-proportion-precision-based-sample-size.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
